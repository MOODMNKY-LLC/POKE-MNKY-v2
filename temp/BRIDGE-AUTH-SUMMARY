# Bridge Authentication Summary

**Date**: January 2026  
**Status**: âœ… Planning Complete - Ready to Implement

---

## âœ… Confirmed: Showdown API Key

**Status**: âœ… **NOT Missing** - Present in `.env`

- **Production (`.env`)**: `SHOWDOWN_API_KEY=5828714b68d1b1251425aba63d28edb164fa3f42e9523fbff8c5979107317750`
- **Local (`.env.local`)**: Empty (fine for local dev)

---

## Bridge Authentication Plan

**Approach**: Option B - Bridge Authentication (as documented)

**Architecture**:
```
User logs in (Supabase/Discord OAuth)
    â†“
Next.js App Auth Callback
    â†“
POST /api/showdown/sync-account
    â†“
Showdown Loginserver API (/api/register)
    â†“
Showdown Account Created/Updated
```

---

## Implementation Checklist

### âœ… Completed

1. âœ… **Planning Document Created** - `BRIDGE-AUTHENTICATION-PLAN.md`
2. âœ… **Environment Variables Added**:
   - `SHOWDOWN_PASSWORD_SECRET` (production)
   - `SHOWDOWN_PASSWORD_SECRET` (local)
   - `LOGINSERVER_URL` (already in .env)

### â¬œ To Implement (Next.js App)

1. **Create API Endpoint**:
   - `/app/api/showdown/sync-account/route.ts`
   - Bridges Supabase user â†’ Showdown account

2. **Add Database Migration**:
   - Add `showdown_username` to profiles table
   - Add `showdown_account_synced` flag
   - Add `showdown_account_synced_at` timestamp

3. **Create Utility Functions**:
   - `/lib/showdown/sync.ts`
   - `syncShowdownAccount(userId)`
   - `getShowdownUsername(userId)`

4. **Add Auth Callback Hook**:
   - Trigger account sync after Supabase login
   - Fire and forget (don't block login)

5. **Add UI Components** (Optional):
   - Show sync status in user profile
   - Manual sync button
   - Showdown username display

---

## Key Features

1. **Deterministic Passwords**:
   - Generated from user ID + secret key
   - User doesn't know password (uses app auth)
   - Password can't be changed (maintains sync)

2. **Username Mapping**:
   - Prefer `showdown_username` from profile
   - Fallback to `discord_username`
   - Fallback to email prefix
   - Final fallback to user ID (max 18 chars)

3. **Automatic Sync**:
   - Triggers on login
   - Updates Showdown account if exists
   - Creates account if new

---

## Environment Variables

**Production (`.env`)**:
```bash
LOGINSERVER_URL=https://aab-login.moodmnky.com
SHOWDOWN_PASSWORD_SECRET=change-me-in-production-generate-secure-random-string
```

**Local (`.env.local`)**:
```bash
LOGINSERVER_URL=http://10.3.0.119:8001  # AAB loginserver local IP
SHOWDOWN_PASSWORD_SECRET=local-dev-secret-change-in-production
```

---

## Next Steps

1. âœ… Plan documented
2. âœ… Environment variables added
3. â¬œ Implement API endpoint (Next.js app)
4. â¬œ Add database migration
5. â¬œ Create utility functions
6. â¬œ Add auth callback hook
7. â¬œ Test end-to-end flow

---

## Documentation

- **Full Plan**: `BRIDGE-AUTHENTICATION-PLAN.md`
- **Loginserver Help**: `showdown-login-server-help.md`
- **Architecture**: `ARCHITECTURE-SPLIT.md`

---

**Ready to implement Bridge Authentication!** ðŸŽ‰
