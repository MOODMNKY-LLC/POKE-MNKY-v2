# Integration Worker Service
# Add this to your server's docker-compose.yml file
# Location: /home/moodmnky/POKE-MNKY/docker-compose.yml

integration-worker:
  build:
    context: .
    dockerfile: scripts/integration-worker/Dockerfile
  container_name: poke-mnky-integration-worker
  restart: unless-stopped
  environment:
    - NODE_ENV=production
    # Use internal Docker network name for Showdown server
    - SHOWDOWN_SERVER_URL=http://pokemon-showdown:8000
    # Supabase configuration (from .env file)
    - SUPABASE_URL=${SUPABASE_URL}
    - SUPABASE_SERVICE_ROLE_KEY=${SUPABASE_SERVICE_ROLE_KEY}
    # Discord configuration (optional, from .env file)
    - DISCORD_RESULTS_CHANNEL_ID=${DISCORD_RESULTS_CHANNEL_ID:-}
  networks:
    - poke-mnky-network
  depends_on:
    - pokemon-showdown
  # Optional: Mount logs directory for debugging
  volumes:
    - ./logs/integration-worker:/app/logs
  # Health check (optional)
  healthcheck:
    test: ["CMD", "node", "-e", "process.exit(0)"]
    interval: 30s
    timeout: 10s
    retries: 3
    start_period: 40s
